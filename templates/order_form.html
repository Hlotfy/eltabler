<!DOCTYPE html>

<style>
.customize {
  background-color: pink;
  border: none;
  color: white;
  padding: 10px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
}
.checkboxBigger {
    width: 20px;
    height: 20px;
    background: #ddd;

    border-radius: 100%;
    position: relative;
}

.bold { 
    font-weight: bold; 
}
</style>
{% extends "index.html" %}

  {% block content %}
  <div id="custombar" class="sidenav">
                  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                  <a><ul id="ingredList">included: </ul></a>
                  <a><ul id="extraList">add ons: </ul></a>
                  
                </div>
  <div id="main">
  <h1>El Table Menu Items</h1>
  <p><strong>Please Select 1 or More Menu Items to Add to Order</strong></p>
  <div class="main">
    <div class="container" id="menuItems">
      <form action="{{url_for('cart')}}" method="GET"> 
      <table id="menuItems">
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Add to Cart</th>
        </tr>
        {% for item in items %}
          {% if item.kind == "sandwich" %}
            <tr value={{item.miid}}>
            <td id="b" class="name">{{item.name}}</td>
            <td id="b2" class="price">{{item.price}}</td>
            <td>
              <input class ="checkboxBigger"  type="checkbox" id="cb" value={{item.miid}}></input>
            </td>
            <td>
              <button class ="customize" type="button" id="customMenu" onclick="openNav(this.value)" value={{item.miid}}> Customize
              </button></td>
            </tr>

          {% elif item.kind == "drink" %}
            <tr miid={{item.miid}}>
            <td class="name">{{item.name}}</td>
            <td class="price">{{item.price}}</td>
            <td>
              <input class ="checkboxBigger" type="checkbox" id="cb" value={{item.miid}}></input>
            </td>  
            </tr>
          {% elif item.kind == "candy" %}
            <tr miid={{item.miid}}>
            <td class="name">{{item.name}}</td>
            <td class="price">{{item.price}}</td>
            <td>
              <input class ="checkboxBigger"  type="checkbox" id="cb" value={{item.miid}}></input>
            </td>
            </tr>
          {% elif item.kind == "snack" %}
            <tr miid={{item.miid}}>
            <td class="name">{{item.name}}</td>
            <td class="price">{{item.price}}</td>
            <td><form action="{{url_for('cart')}}" method="GET">
              <input class ="checkboxBigger"  type="checkbox" id="cb" value="{{item.miid}}"></input>
            </td>
            </tr>
          {% endif %}
        {% endfor %}
        </table>
       <br>
      Total Price: <input type="text" name="subtotal" value="0" />
      <br><button type="submit">Checkout!</button>
      </form>
    </div>
  </div>
</div>
<script>
  
/* global $ */

var URL = "{{url_for('cart')}}";
var URLm = "{{url_for('order')}}"

  $("#menuItems").on(
    "click", "input[type=checkbox]",
    function(event) {
      var name = $(this).closest("tr").find(".name").text();
      var price = $(this).closest("tr").find(".price").text();
      console.log(name)
      var miid = $(this).val();
      $.post(URL,{'miid':miid, 'name':name, 'price':price},function(resp) { 
                var name = resp.name;
                var price = resp.price;
                $("#[miid=" + resp.miid +"]").find(".name").text(name);
            },
            'json');
      
    });

/* Set the width of the side navigation to 250px and the left margin of the page content to 250px */
function openNav(miid) {
  $("#ingredList").empty()
  document.getElementById("custombar").style.width = "400px";
  document.getElementById("main").style.marginLeft = "400px";
  // var miid = $(this).closest("tr").find("input[type=checkbox]").val();
   
   $.post(URLm,{'miid':miid},function(resp) { 
                var ingred = resp.ingred;
                var extra = resp.extra;
                console.log(ingred);
                console.log(extra);
                // console.log(miid);
                 $('#ingredList').val(miid)
                for (var i in ingred){
                  $('#ingredList').prepend('<a href="#" type="button" >'+ingred[i]['name']+'  <input type="checkbox" class = "calc" id="include" kind="'+ingred[i]['kind']+
                  '" value="'+ingred[i]['price']+'"iid="'+ingred[i]['iid']+'"checked>'+   ingred[i]['price']+'</input> </a>');
                  console.log($(this).find('#ingredList').find('input[iid='+ingred[i]['iid']+']').iid);
                 }
                for (var i in extra){
                  $('#extraList').append('<a href="#" type="button" >'+extra[i]['name']+'  <input class ="calc" type="checkbox" value='+extra[i]['price']+'>'+extra[i]['price']+'</input> </a>');
                }
                // $("tr[value=" + miid +"]").find(".price").text(nprice);
                // $("input[name=sum]").val(nprice)
                $("tr[value=" + miid +"]").append('Item Price: <input type="text" name="sum" value="0" />');
                // $('#extraList').append('Item Price: <input type="text" name="sum" value="0" />');
            },
            'json');
    
}

// toggle for bolding later
// function bold() { 
//   document.getElementById('b').classList.toggle('bold'); 
//   document.getElementById('b2').classList.toggle('bold'); 
//   console.log("you are bold");
// }

function calcTotal(){
  var total = 0;
  $(".calc:checked").each(function(){
        total+=parseFloat($(this).val(),10);
    });
    $("input[name=sum]").val(total)
}
  
    $("#extraList").on("click", "input[type=checkbox]", function(event){
      calcTotal();
    });
    
// var miid = $(this);
// console.log(miid)
function calcPrice(){
  var total =0;
  $(".checkboxBigger:checked").each(function(){
        total+=parseFloat($(this).closest("tr").find(".price").text(),10);
    });
    $("input[name=subtotal]").val(total)
}
    $("#menuItems").on("click", "input[type=checkbox]", function(event){
      calcPrice();
    });
    
// $("#ingredList").on(
//     "click", "input[type=checkbox]",
//     function() {
//       var name = $(this).name;
//       var iprice = parseFloat($(this).val());
//       var miid = $(this).closest("#ingredList").val();
//       console.log(miid);
//       console.log(iprice);
//       var oprice = parseFloat($("tr[value=" + miid +"]").find(".price").text());
      
//       console.log($(this)[0].checked);
//       var nprice = oprice;
//       if ($(this)[0].checked === true) {
//         nprice+=iprice;
//       }else{
//         nprice-=iprice;
//       }
//       console.log(nprice);
//       $("tr[value=" + miid +"]").find(".price").text(nprice);
//       $("input[name=sum]").val(nprice)
//   });
   
  // $("#extraList").on(
  //   "click", "input[type=checkbox]",
  //   function() {
  //     var name = $(this).name;
  //     var iprice = parseFloat($(this).val());
  //     var miid = $(this).closest("#ingredList").val();
  //     console.log(miid)
  //     console.log(iprice);
  //     // var oprice = document.getElementById(miid)
      
  //     // console.log(oprice);
  //     console.log($(this)[0].checked);
  //     var nprice = oprice;
  //     if ($(this)[0].checked === true) {
  //       nprice+=iprice;
  //     }else{
  //       nprice-=iprice;
  //     }
  //     $("tr[value=" + miid +"]").find(".price").text(nprice);
  //     $("input[name=sum]").val(nprice)
  // });



/* Set the width of the side navigation to 0 and the left margin of the page content to 0 */
function closeNav() {
  document.getElementById("custombar").style.width = "0";
  document.getElementById("main").style.marginLeft = "0";
}
  </script>
  {% endblock %}
